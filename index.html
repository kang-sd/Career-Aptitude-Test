
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CAREER Â· ì§„ë¡œì§ì—… ì„±í–¥ ë¶„ì„</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Noto+Serif+KR:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg:      #faf8f4;
      --surface: #ffffff;
      --ink:     #1a1612;
      --ink2:    #4a4540;
      --gold:    #b8903a;
      --gold2:   #d4aa5a;
      --gold-bg: #fdf6e9;
      --border:  #e8e2d8;
      --accent:  #8b6914;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: var(--bg); color: var(--ink); font-family: 'Noto Serif KR', serif; min-height: 100vh; }

    .top-bar { height: 4px; background: linear-gradient(90deg, var(--gold), var(--gold2), var(--gold)); }
    .container { max-width: 780px; margin: 0 auto; padding: 0 24px 80px; }

    /* í—¤ë” */
    .header { text-align: center; padding: 52px 0 44px; animation: fadeDown 0.8s ease both; }
    .header-eyebrow { font-size: 10px; letter-spacing: 5px; text-transform: uppercase; color: var(--gold); margin-bottom: 18px; }
    .header h1 { font-family: 'Cormorant Garamond', serif; font-size: clamp(48px, 10vw, 84px); font-weight: 300; font-style: italic; color: var(--ink); line-height: 0.95; letter-spacing: -2px; }
    .header h1 span { color: var(--gold); }
    .header-rule { width: 50px; height: 1px; background: linear-gradient(90deg, transparent, var(--gold), transparent); margin: 22px auto 18px; }
    .header-sub { font-size: 13px; color: var(--ink2); }

    /* ì•ˆë‚´ ì¹´ë“œ */
    .intro-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1px; background: var(--border); border: 1px solid var(--border); margin-bottom: 44px; animation: fadeUp 0.8s 0.2s ease both; }
    .intro-card { background: var(--surface); padding: 24px 18px; text-align: center; }
    .intro-card-num { font-family: 'Cormorant Garamond', serif; font-size: 38px; font-weight: 300; color: var(--gold); line-height: 1; margin-bottom: 6px; }
    .intro-card-title { font-size: 9px; letter-spacing: 3px; text-transform: uppercase; color: var(--gold); margin-bottom: 8px; }
    .intro-card p { font-size: 12px; color: var(--ink2); line-height: 1.6; }

    /* ì´ë¦„ ì…ë ¥ */
    .name-section { margin-bottom: 36px; animation: fadeUp 0.8s 0.3s ease both; }
    .section-label { font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: var(--gold); margin-bottom: 10px; }
    .name-row { display: flex; gap: 10px; }
    .name-input { flex: 1; background: var(--surface); border: 1px solid var(--border); color: var(--ink); font-family: 'Noto Serif KR', serif; font-size: 16px; padding: 14px 18px; outline: none; transition: border-color 0.25s; }
    .name-input:focus { border-color: var(--gold); }
    .name-input::placeholder { color: #bbb; }
    .btn-search { background: var(--surface); border: 1px solid var(--gold); color: var(--gold); font-family: 'Cormorant Garamond', serif; font-size: 15px; letter-spacing: 2px; padding: 14px 26px; cursor: pointer; transition: all 0.25s; white-space: nowrap; }
    .btn-search:hover { background: var(--gold); color: #fff; }

    /* í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */
    .confirm-box { background: var(--gold-bg); border: 1px solid rgba(184,144,58,0.3); padding: 22px 24px; margin-bottom: 28px; animation: fadeUp 0.3s ease; }
    .confirm-box p { font-size: 15px; color: var(--ink); margin-bottom: 16px; line-height: 1.7; }
    .confirm-btns { display: flex; gap: 10px; }
    .btn-yes { background: var(--gold); border: none; color: #fff; font-family: 'Noto Serif KR', serif; font-size: 14px; padding: 11px 26px; cursor: pointer; transition: opacity 0.2s; }
    .btn-yes:hover { opacity: 0.85; }
    .btn-no { background: transparent; border: 1px solid var(--border); color: var(--ink2); font-family: 'Noto Serif KR', serif; font-size: 14px; padding: 11px 26px; cursor: pointer; transition: all 0.2s; }
    .btn-no:hover { border-color: var(--ink2); color: var(--ink); }

    /* ì§„í–‰ ë°” */
    .progress-wrap { position: sticky; top: 0; z-index: 10; background: var(--bg); padding: 10px 0 14px; border-bottom: 1px solid var(--border); margin-bottom: 8px; }
    .progress-bar-bg { height: 2px; background: var(--border); position: relative; }
    .progress-bar-fill { position: absolute; inset: 0; background: linear-gradient(90deg, var(--gold), var(--gold2)); transform-origin: left; transform: scaleX(0); transition: transform 0.3s ease; }
    .progress-text { font-size: 11px; letter-spacing: 1px; color: var(--ink2); text-align: right; margin-top: 6px; }

    /* ë¬¸í•­ êµ¬ë¶„ì„  */
    .questions-header { display: flex; align-items: center; gap: 18px; margin-bottom: 8px; }
    .questions-header-line { flex: 1; height: 1px; background: var(--border); }
    .questions-header-text { font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: var(--gold); }

    /* ë¬¸í•­ */
    #questionForm { animation: fadeUp 0.8s 0.4s ease both; }
    .question { border-bottom: 1px solid var(--border); padding: 24px 0; }
    .question:last-child { border-bottom: none; }
    .q-meta { display: flex; align-items: baseline; gap: 12px; margin-bottom: 14px; }
    .q-num { font-family: 'Cormorant Garamond', serif; font-size: 13px; color: var(--gold); min-width: 28px; opacity: 0.6; }
    .q-text { font-size: 15px; color: var(--ink); line-height: 1.65; }
    .q-choices { display: flex; gap: 10px; padding-left: 40px; flex-wrap: wrap; }
    .btn-choice { background: var(--surface); border: 1px solid var(--border); color: var(--ink2); font-family: 'Noto Serif KR', serif; font-size: 14px; padding: 11px 22px; cursor: pointer; transition: all 0.2s; min-width: 80px; text-align: center; }
    .btn-choice:hover { border-color: var(--gold2); color: var(--ink); background: var(--gold-bg); }
    .btn-choice.selected { background: var(--gold); border-color: var(--gold); color: #fff; font-weight: 600; }

    /* ê²½ê³  */
    .warning-bar { background: #fff5f5; border-left: 3px solid #e05252; color: #b83232; padding: 12px 18px; font-size: 13px; margin: 12px 0; display: none; line-height: 1.6; }

    /* ì œì¶œ ë²„íŠ¼ */
    .submit-wrap { padding: 40px 0 0; text-align: center; }
    .btn-submit { background: var(--gold); border: none; color: #fff; font-family: 'Cormorant Garamond', serif; font-size: 18px; letter-spacing: 3px; padding: 18px 60px; cursor: pointer; width: 100%; max-width: 380px; transition: background 0.25s, transform 0.15s; }
    .btn-submit:hover { background: var(--accent); transform: translateY(-1px); }
    .btn-submit:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    /* ìŠ¤í”¼ë„ˆ */
    #spinner { display: none; text-align: center; padding: 60px 0; }
    .spinner-ring { width: 44px; height: 44px; border: 2px solid var(--border); border-top-color: var(--gold); border-radius: 50%; animation: spin 0.9s linear infinite; margin: 0 auto 14px; }
    .spinner-text { font-size: 12px; letter-spacing: 2px; color: var(--ink2); text-transform: uppercase; }

    /* ê²°ê³¼ ì„¹ì…˜ */
    #resultSection { display: none; animation: fadeUp 0.7s ease both; }
    .result-header { text-align: center; padding: 56px 0 44px; border-bottom: 1px solid var(--border); margin-bottom: 44px; }
    .result-eyebrow { font-size: 10px; letter-spacing: 5px; text-transform: uppercase; color: var(--gold); margin-bottom: 22px; }
    .result-type { font-family: 'Cormorant Garamond', serif; font-size: clamp(36px, 8vw, 56px); font-weight: 300; color: var(--gold); line-height: 1.2; letter-spacing: -1px; }
    .result-subtitle { font-size: 15px; color: var(--ink2); margin-top: 18px; font-style: italic; line-height: 1.6; }

    /* ì°¨íŠ¸ */
    .chart-section { background: var(--surface); border: 1px solid var(--border); padding: 28px 28px 24px; margin-bottom: 40px; }
    .chart-title { font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: var(--gold); margin-bottom: 20px; text-align: center; }
    .chart-controls { text-align: center; margin-bottom: 20px; }
    .chart-select { background: var(--surface); border: 1px solid var(--border); color: var(--ink); font-family: 'Noto Serif KR', serif; font-size: 14px; padding: 8px 16px; outline: none; cursor: pointer; }

    /* ê²°ê³¼ í…Œì´ë¸” */
    .result-fields { border: 1px solid var(--border); margin-bottom: 40px; background: var(--surface); }
    .field-row { display: grid; grid-template-columns: 150px 1fr 1fr; border-bottom: 1px solid var(--border); }
    .field-row:last-child { border-bottom: none; }
    .field-key { padding: 18px 16px 18px 20px; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: var(--gold); background: var(--gold-bg); border-right: 1px solid var(--border); display: flex; align-items: center; line-height: 1.5; }
    .field-val { padding: 18px 20px; font-size: 14px; color: var(--ink2); line-height: 1.85; border-right: 1px solid var(--border); }
    .field-val:last-child { border-right: none; }

    /* í•˜ë‹¨ ë²„íŠ¼ */
    .result-actions { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
    .btn-print { background: var(--gold); border: none; color: #fff; font-family: 'Noto Serif KR', serif; font-size: 15px; padding: 16px 36px; cursor: pointer; transition: background 0.2s, transform 0.15s; display: flex; align-items: center; gap: 8px; }
    .btn-print:hover { background: var(--accent); transform: translateY(-1px); }
    .btn-restart { background: var(--surface); border: 1px solid var(--border); color: var(--ink2); font-family: 'Noto Serif KR', serif; font-size: 15px; padding: 16px 36px; cursor: pointer; transition: all 0.2s; }
    .btn-restart:hover { border-color: var(--ink); color: var(--ink); }

    /* ì• ë‹ˆë©”ì´ì…˜ */
    @keyframes fadeDown { from { opacity:0; transform:translateY(-16px); } to { opacity:1; transform:translateY(0); } }
    @keyframes fadeUp   { from { opacity:0; transform:translateY(16px);  } to { opacity:1; transform:translateY(0); } }
    @keyframes spin     { to { transform: rotate(360deg); } }

    /* ë¯¸ì‘ë‹µ ë¬¸í•­ í•˜ì´ë¼ì´íŠ¸ */
    .question.unanswered {
      background: #fff5f5;
      border-left: 3px solid #e05252;
      padding-left: 14px;
      margin-left: -17px;
    }
    .question.unanswered .q-num { color: #e05252; opacity: 1; }

    /* â•â•â•â•â•â•â•â•â•â• ì¸ì‡„ ìŠ¤íƒ€ì¼ â•â•â•â•â•â•â•â•â•â• */
    @media print {
      .top-bar, .header, .intro-cards, .name-section,
      .progress-wrap, .questions-header, #questionForm,
      .warning-bar, .submit-wrap, #spinner,
      #searchResponse, .result-actions { display: none !important; }
      body { background: #fff !important; }
      .container { max-width: 100%; padding: 0 16px; }
      #resultSection { display: block !important; }
    }

    /* ë°˜ì‘í˜• */
    @media (max-width: 600px) {
      .intro-cards { grid-template-columns: repeat(2, 1fr); }
      .q-choices { padding-left: 0; }
      .btn-choice { flex: 1; min-width: 110px; }
      .field-row { grid-template-columns: 1fr; }
      .field-key { border-right: none; border-bottom: 1px solid var(--border); }
      .field-val { border-right: none !important; border-bottom: 1px solid var(--border); }
      .field-val:last-child { border-bottom: none; }
    }

    /* â•â• ê´€ë¦¬ì ëª¨ë‹¬ â•â• */
    .modal-overlay { position: fixed; inset: 0; background: rgba(26,22,18,0.75); z-index: 1000; display: none; align-items: center; justify-content: center; }
    .modal-overlay.open { display: flex; }
    .modal { background: var(--surface); width: 100%; max-width: 560px; max-height: 90vh; overflow-y: auto; border-top: 3px solid var(--gold); animation: fadeUp 0.3s ease; }
    .modal-header { padding: 28px 28px 20px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
    .modal-title { font-family: 'Cormorant Garamond', serif; font-size: 22px; font-weight: 300; color: var(--ink); letter-spacing: 1px; }
    .modal-close { background: none; border: none; font-size: 22px; color: var(--ink2); cursor: pointer; padding: 4px 8px; line-height: 1; }
    .modal-close:hover { color: var(--ink); }
    .modal-body { padding: 24px 28px; }
    .pw-form { display: flex; flex-direction: column; gap: 14px; }
    .pw-input { background: var(--bg); border: 1px solid var(--border); color: var(--ink); font-family: 'Noto Serif KR', serif; font-size: 20px; padding: 14px 18px; outline: none; text-align: center; letter-spacing: 10px; transition: border-color 0.25s; }
    .pw-input:focus { border-color: var(--gold); }
    .btn-pw-ok { background: var(--gold); border: none; color: #fff; font-family: 'Cormorant Garamond', serif; font-size: 16px; letter-spacing: 2px; padding: 14px; cursor: pointer; transition: background 0.2s; }
    .btn-pw-ok:hover { background: var(--accent); }
    .pw-error { color: #c0392b; font-size: 13px; text-align: center; display: none; }
    .admin-toolbar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; flex-wrap: wrap; gap: 10px; }
    .admin-count { font-size: 12px; color: var(--ink2); letter-spacing: 1px; }
    .btn-admin-refresh { background: none; border: 1px solid var(--border); color: var(--ink2); font-family: 'Noto Serif KR', serif; font-size: 13px; padding: 7px 16px; cursor: pointer; transition: all 0.2s; }
    .btn-admin-refresh:hover { border-color: var(--gold); color: var(--gold); }
    .admin-list { display: flex; flex-direction: column; gap: 8px; }
    .admin-item { display: grid; grid-template-columns: 1fr auto auto; align-items: center; gap: 12px; padding: 14px 16px; background: var(--bg); border: 1px solid var(--border); }
    .admin-item.expired { opacity: 0.5; border-style: dashed; }
    .admin-item-name { font-size: 15px; color: var(--ink); margin-bottom: 3px; }
    .admin-item-time { font-size: 11px; color: var(--ink2); }
    .admin-item-type { font-family: 'Cormorant Garamond', serif; font-size: 13px; color: var(--gold); margin-top: 2px; }
    .admin-item-badge { font-size: 10px; letter-spacing: 1px; padding: 3px 8px; border: 1px solid; margin-left: 8px; }
    .badge-active  { color: var(--gold); border-color: var(--gold); background: var(--gold-bg); }
    .badge-expired { color: #999; border-color: #ccc; background: #f5f5f5; }
    .btn-view-result { background: none; border: 1px solid var(--gold); color: var(--gold); font-family: 'Noto Serif KR', serif; font-size: 12px; padding: 6px 14px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
    .btn-view-result:hover { background: var(--gold); color: #fff; }
    .btn-del { background: none; border: 1px solid var(--border); color: #c0392b; font-family: 'Noto Serif KR', serif; font-size: 12px; padding: 6px 14px; cursor: pointer; transition: all 0.2s; white-space: nowrap; }
    .btn-del:hover { background: #fdf0ee; border-color: #c0392b; }
    .admin-empty { text-align: center; color: var(--ink2); font-size: 14px; padding: 40px 0; font-style: italic; }
  </style>
</head>
<body>

<!-- â•â• ê´€ë¦¬ì ëª¨ë‹¬ â•â• -->
<div class="modal-overlay" id="adminOverlay">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">ê´€ë¦¬ì ì¸ì¦</div>
      <button class="modal-close" onclick="closeAdmin()">âœ•</button>
    </div>
    <div class="modal-body">
      <div id="pwPanel">
        <div class="pw-form">
          <input class="pw-input" type="password" id="pwInput" placeholder="â—â—â—â—" maxlength="20"
            onkeydown="if(event.key==='Enter') doAdminLogin()">
          <button class="btn-pw-ok" onclick="doAdminLogin()">í™•ì¸</button>
          <div class="pw-error" id="pwError">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
        </div>
      </div>
      <div id="listPanel" style="display:none;">
        <div class="admin-toolbar">
          <div class="admin-count" id="adminCount"></div>
          <button class="btn-admin-refresh" onclick="loadAdminList()">â†» ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="admin-list" id="adminList"></div>
      </div>
    </div>
  </div>
</div>

<div class="top-bar"></div>
<div class="container">

  <!-- ë©”ì¸ í—¤ë” -->
  <div class="header">
    <div class="header-eyebrow">Jennifer Canvas Â· ì§„ë¡œì§ì—… ë¶„ì„</div>
    <h1 onclick="openAdmin()" style="cursor:default;">Ca<span>reer</span></h1>
    <div class="header-rule"></div>
    <div class="header-sub">ë‹¹ì‹ ì˜ ì§„ë¡œ ì ì„±ì„ ë¹„ì¶”ëŠ” 6ê°€ì§€ ì„±í–¥</div>
  </div>

  <!-- ì•ˆë‚´ ì¹´ë“œ -->
  <div class="intro-cards">
    <div class="intro-card">
      <div class="intro-card-num">60</div>
      <div class="intro-card-title">ë¬¸í•­ êµ¬ì„±</div>
      <p>ì •ë°€í•œ ê²°ê³¼ë¥¼ ìœ„í•´<br>ì„¤ê³„ëœ 60ê°œ ë¬¸í•­</p>
    </div>
    <div class="intro-card">
      <div class="intro-card-num">6</div>
      <div class="intro-card-title">ì„±í–¥ ìœ í˜•</div>
      <p>ì§„ë¡œÂ·ì§ì—…Â·ì ì„±<br>ì‹¬ì¸µ ë¶„ì„</p>
    </div>
    <div class="intro-card">
      <div class="intro-card-num">3</div>
      <div class="intro-card-title">ì¼ ë³´ê´€</div>
      <p>ì´ë¦„ ê²€ìƒ‰ìœ¼ë¡œ<br>3ì¼ ì´ë‚´ ì¬í™•ì¸ ê°€ëŠ¥</p>
    </div>
    <div class="intro-card">
      <div class="intro-card-num">âˆ</div>
      <div class="intro-card-title">ì‹œê°í™”</div>
      <p>6ê°€ì§€ ì¶• ì ìˆ˜ë¥¼<br>ê·¸ë˜í”„ë¡œ í•œëˆˆì—</p>
    </div>
  </div>

  <!-- ì´ë¦„ ì…ë ¥ -->
  <div class="name-section">
    <div class="section-label">ì´ë¦„ ì…ë ¥</div>
    <div class="name-row">
      <input class="name-input" type="text" id="nameInput" placeholder="ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
      <button class="btn-search" onclick="searchPrevious()">ê²€ìƒ‰</button>
    </div>
  </div>

  <div id="searchResponse"></div>
  <div class="warning-bar" id="searchWarningBox"></div>
  <div class="warning-bar" id="answerWarningBox"></div>

  <!-- ì§„í–‰ ë°” -->
  <div class="progress-wrap" id="progressWrap">
    <div class="progress-bar-bg">
      <div class="progress-bar-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText">0/60</div>
  </div>

  <!-- ë¬¸í•­ êµ¬ë¶„ì„  -->
  <div class="questions-header" id="questionsHeader">
    <div class="questions-header-line"></div>
    <div class="questions-header-text">Questions</div>
    <div class="questions-header-line"></div>
  </div>

  <!-- ë¬¸í•­ í¼ -->
  <form id="questionForm" onsubmit="return false;"></form>

  <!-- ì œì¶œ ë²„íŠ¼ -->
  <div class="submit-wrap" id="submitWrap">
    <button class="btn-submit" onclick="submitAnswers()">ê²°ê³¼ ë³´ê¸°</button>
  </div>

  <!-- ìŠ¤í”¼ë„ˆ -->
  <div id="spinner">
    <div class="spinner-ring"></div>
    <div class="spinner-text">ë¶„ì„ ì¤‘...</div>
  </div>

  <!-- ê²°ê³¼ ì„¹ì…˜ -->
  <div id="resultSection"></div>

</div>

<script>
  // âœ… Cloud Functions URL
  const FN = "https://us-central1-career-aptitude-test-b7b2c.cloudfunctions.net";

  let questions = [];
  let answers = {};
  let adminPassword = null;
  let radarChart = null;
  let barChart = null;

  // â”€â”€ í˜ì´ì§€ ë¡œë“œ ì‹œ ë¬¸í•­ ì¦‰ì‹œ í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.onload = () => {
    fetch(`${FN}/getQuestions`, { method: "POST" })
      .then(r => r.json())
      .then(data => {
        if (data.questions) {
          questions = data.questions;
          renderQuestions();
        }
      })
      .catch(e => {
        console.error("ë¬¸í•­ ë¡œë“œ ì˜¤ë¥˜:", e);
        showWarning("searchWarningBox", "ë¬¸í•­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      });
  };

  // â”€â”€ ë¬¸í•­ ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderQuestions() {
    const form = document.getElementById("questionForm");
    form.innerHTML = "";

    questions.forEach((q, idx) => {
      const div = document.createElement("div");
      div.className = "question";
      div.dataset.id = q.id;

      div.innerHTML = `
        <div class="q-meta">
          <div class="q-num">Q${idx + 1}</div>
          <div class="q-text">${q.text}</div>
        </div>
        <div class="q-choices">
          ${[1,2,3,4,5].map(n => `
            <button type="button" class="btn-choice" data-qid="${q.id}" data-score="${q[`score${n}`]}" onclick="selectChoice(this)">
              ${q[`select${n}`]}
            </button>
          `).join("")}
        </div>
      `;

      form.appendChild(div);
    });
  }

  // â”€â”€ ì„ íƒì§€ í´ë¦­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function selectChoice(btn) {
    const qid = btn.dataset.qid;
    const score = parseInt(btn.dataset.score, 10);

    // ê°™ì€ ë¬¸í•­ ë‚´ ë‹¤ë¥¸ ë²„íŠ¼ ì„ íƒ í•´ì œ
    document.querySelectorAll(`.btn-choice[data-qid="${qid}"]`).forEach(b => b.classList.remove("selected"));
    btn.classList.add("selected");

    answers[qid] = score;
    updateProgress();

    // ë¯¸ì‘ë‹µ í•˜ì´ë¼ì´íŠ¸ ì œê±°
    const qDiv = document.querySelector(`.question[data-id="${qid}"]`);
    if (qDiv) qDiv.classList.remove("unanswered");
  }

  // â”€â”€ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function updateProgress() {
    const total = questions.length;
    const answered = Object.keys(answers).length;
    const pct = total ? (answered / total) : 0;

    document.getElementById("progressFill").style.transform = `scaleX(${pct})`;
    document.getElementById("progressText").innerText = `${answered}/${total}`;
  }

  // â”€â”€ ì´ì „ ê²€ì‚¬ ê²€ìƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function searchPrevious() {
    const name = document.getElementById("nameInput").value.trim();
    if (!name) {
      showWarning("searchWarningBox", "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    try {
      const res = await fetch(`${FN}/loadPreviousResult`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name })
      });
      const data = await res.json();

      const box = document.getElementById("searchResponse");
      if (data.found) {
        box.innerHTML = `
          <div class="confirm-box">
            <p>ì´ì „ì— ê²€ì‚¬ë¥¼ ì™„ë£Œí•˜ì˜€ìŠµë‹ˆë‹¤. ê²°ê³¼ë¥¼ í™•ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="confirm-btns">
              <button class="btn-yes" onclick="loadExistingResult(${JSON.stringify(data.result).replace(/"/g, '&quot;')})">ì˜ˆ</button>
              <button class="btn-no" onclick="clearSearch()">ì•„ë‹ˆì˜¤</button>
            </div>
          </div>`;
      } else {
        showWarning("searchWarningBox", "ìµœê·¼ 3ì¼ ì´ë‚´ ê²€ì‚¬ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");
      }
    } catch (e) {
      console.error(e);
      showWarning("searchWarningBox", "ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }

  function loadExistingResult(result) {
    document.getElementById("searchResponse").innerHTML = "";
    displayResult(result);
  }

  function clearSearch() {
    document.getElementById("searchResponse").innerHTML = "";
  }

  // â”€â”€ ì œì¶œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function submitAnswers() {
    const name = document.getElementById("nameInput").value.trim();

    // ì´ë¦„ ì²´í¬
    if (!name) {
      showWarning("answerWarningBox", "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      document.getElementById("nameInput").focus();
      document.getElementById("nameInput").scrollIntoView({ behavior: "smooth", block: "center" });
      return;
    }

    // ë¯¸ì‘ë‹µ ì²´í¬
    if (Object.keys(answers).length < questions.length) {
      questions.forEach(q => {
        const div = document.querySelector(`.question[data-id="${q.id}"]`);
        if (!(q.id in answers)) {
          div.classList.add("unanswered");
        }
      });
      showWarning("answerWarningBox", "ëª¨ë“  ë¬¸í•­ì— ì‘ë‹µí•´ì£¼ì„¸ìš”.");
      document.querySelector(".question.unanswered").scrollIntoView({ behavior: "smooth", block: "center" });
      return;
    }

    document.getElementById("spinner").style.display = "block";
    document.getElementById("questionForm").style.display = "none";
    document.getElementById("submitWrap").style.display = "none";
    document.getElementById("progressWrap").style.display = "none";
    document.getElementById("questionsHeader").style.display = "none";

    try {
      const res = await fetch(`${FN}/saveAnswers`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, answers })
      });
      const data = await res.json();
      document.getElementById("spinner").style.display = "none";
      displayResult(data);
    } catch (e) {
      console.error(e);
      document.getElementById("spinner").style.display = "none";
      showWarning("answerWarningBox", "ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  }

  // â”€â”€ ê²°ê³¼ í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function displayResult(data) {
    document.getElementById("resultSection").innerHTML = "";
    document.getElementById("resultSection").style.display = "block";

    const { firstType, firstScore, secondType, secondScore, thirdType, thirdScore, typeScores, descriptions } = data;

    let html = `
      <div class="result-header">
        <div class="result-eyebrow">ë‹¹ì‹ ì˜ ì§„ë¡œ ì„±í–¥</div>
        <div class="result-type">${firstType}</div>
        <div class="result-subtitle">1ìˆœìœ„ ${firstScore}ì  Â· 2ìˆœìœ„: ${secondType} ${secondScore}ì  Â· 3ìˆœìœ„: ${thirdType} ${thirdScore}ì </div>
      </div>

      <!-- ì°¨íŠ¸ -->
      <div class="chart-section">
        <div class="chart-title">ì„±í–¥ ë¶„í¬</div>
        <div class="chart-controls">
          <select class="chart-select" onchange="switchChart(this.value)">
            <option value="radar">ë ˆì´ë” ì°¨íŠ¸</option>
            <option value="bar">ë§‰ëŒ€ ê·¸ë˜í”„</option>
          </select>
        </div>
        <canvas id="radarChart" style="max-height:400px;"></canvas>
        <canvas id="barChart" style="max-height:400px; display:none;"></canvas>
      </div>

      <!-- ê²°ê³¼ í…Œì´ë¸” -->
      <div class="result-fields">
        <div class="field-row" style="background:var(--gold-bg); border-bottom:2px solid var(--gold);">
          <div class="field-key" style="font-weight:600;">êµ¬ë¶„</div>
          <div class="field-val" style="font-weight:600; color:var(--gold);">1ìˆœìœ„: ${firstType}</div>
          <div class="field-val" style="font-weight:600; color:var(--ink2);">2ìˆœìœ„: ${secondType}</div>
        </div>`;

    const fields = ["ì„±í–¥ ìš”ì•½", "ì£¼ìš” ì„±í–¥", "í–‰ë™ íŠ¹ì„±", "ì„±ê²© íŠ¹ì„±", "ì—­í•  ìŠ¤íƒ€ì¼", "ì„±í–¥ ì„¤ëª…", "ì£¼ìš” íŠ¹ì§ˆ", "ì§ì—…ì  íŠ¹ì„±", "ìê¸°ê°œë°œ íŒ", "ì„±ì¥ íŒ"];
    fields.forEach(f => {
      html += `
        <div class="field-row">
          <div class="field-key">${f}</div>
          <div class="field-val">${descriptions.first[f] || ""}</div>
          <div class="field-val">${descriptions.second[f] || ""}</div>
        </div>`;
    });

    html += `
      </div>

      <!-- í•˜ë‹¨ ë²„íŠ¼ -->
      <div class="result-actions">
        <button class="btn-print" onclick="window.print()">ğŸ“„ PDF ì €ì¥</button>
        <button class="btn-restart" onclick="location.reload()">ğŸ”„ ì²˜ìŒìœ¼ë¡œ</button>
      </div>
    `;

    document.getElementById("resultSection").innerHTML = html;
    document.getElementById("resultSection").scrollIntoView({ behavior: "smooth" });

    // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    drawRadarChart(typeScores);
    drawBarChart(typeScores);
  }

  // â”€â”€ ì°¨íŠ¸ ê·¸ë¦¬ê¸° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function drawRadarChart(typeScores) {
    const ctx = document.getElementById("radarChart").getContext("2d");
    const labels = ["í˜„ì‹¤ì  ì‹¤ìš©í˜•", "ë…¼ë¦¬ì  ë¶„ì„í˜•", "ì°½ì˜ì  ì˜ˆìˆ í˜•", "ì¸ê°„ ì¤‘ì‹¬ ì‚¬íšŒí˜•", "ì£¼ë„ì  ë¦¬ë”í˜•", "ì²´ê³„ì  ê·œë²”í˜•"];
    const scores = labels.map(l => typeScores[l] || 0);

    if (radarChart) radarChart.destroy();
    radarChart = new Chart(ctx, {
      type: "radar",
      data: {
        labels,
        datasets: [{
          label: "ì ìˆ˜",
          data: scores,
          backgroundColor: "rgba(184,144,58,0.2)",
          borderColor: "#b8903a",
          pointBackgroundColor: "#b8903a",
          borderWidth: 2
        }]
      },
      options: {
        scales: { r: { beginAtZero: true, max: 50 } },
        plugins: { legend: { display: false } }
      }
    });
  }

  function drawBarChart(typeScores) {
    const ctx = document.getElementById("barChart").getContext("2d");
    const labels = ["í˜„ì‹¤ì  ì‹¤ìš©í˜•", "ë…¼ë¦¬ì  ë¶„ì„í˜•", "ì°½ì˜ì  ì˜ˆìˆ í˜•", "ì¸ê°„ ì¤‘ì‹¬ ì‚¬íšŒí˜•", "ì£¼ë„ì  ë¦¬ë”í˜•", "ì²´ê³„ì  ê·œë²”í˜•"];
    const scores = labels.map(l => typeScores[l] || 0);

    if (barChart) barChart.destroy();
    barChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: "ì ìˆ˜",
          data: scores,
          backgroundColor: "#b8903a"
        }]
      },
      options: {
        scales: { y: { beginAtZero: true, max: 50 } },
        plugins: { legend: { display: false } }
      }
    });
  }

  function switchChart(type) {
    if (type === "radar") {
      document.getElementById("radarChart").style.display = "block";
      document.getElementById("barChart").style.display = "none";
    } else {
      document.getElementById("radarChart").style.display = "none";
      document.getElementById("barChart").style.display = "block";
    }
  }

  // â”€â”€ ê²½ê³  í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showWarning(boxId, msg) {
    const box = document.getElementById(boxId);
    box.innerText = msg;
    box.style.display = "block";
    setTimeout(() => box.style.display = "none", 4000);
  }

  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  // ê´€ë¦¬ì ëª¨ë“œ
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  function openAdmin() {
    document.getElementById("adminOverlay").classList.add("open");
    document.getElementById("pwInput").value = "";
    document.getElementById("pwInput").focus();
  }

  function closeAdmin() {
    document.getElementById("adminOverlay").classList.remove("open");
    document.getElementById("pwPanel").style.display = "block";
    document.getElementById("listPanel").style.display = "none";
    document.getElementById("pwError").style.display = "none";
  }

  async function doAdminLogin() {
    const pw = document.getElementById("pwInput").value.trim();
    if (!pw) return;

    try {
      const res = await fetch(`${FN}/adminLogin`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password: pw })
      });
      const data = await res.json();

      if (data.ok) {
        adminPassword = pw;
        document.getElementById("pwPanel").style.display = "none";
        document.getElementById("listPanel").style.display = "block";
        document.getElementById("modalTitle").innerText = "ê´€ë¦¬ì íŒ¨ë„";
        loadAdminList();
      } else {
        document.getElementById("pwError").style.display = "block";
      }
    } catch (e) {
      console.error(e);
      alert("ë¡œê·¸ì¸ ì˜¤ë¥˜");
    }
  }

  async function loadAdminList() {
    try {
      const res = await fetch(`${FN}/adminGetResults`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password: adminPassword })
      });
      const data = await res.json();

      const list = document.getElementById("adminList");
      const count = document.getElementById("adminCount");

      if (!data.results || !data.results.length) {
        list.innerHTML = '<div class="admin-empty">ì €ì¥ëœ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        count.innerText = "ì´ 0ê±´";
        return;
      }

      count.innerText = `ì´ ${data.results.length}ê±´`;
      list.innerHTML = data.results.map(r => {
        const badge = r.expired
          ? '<span class="admin-item-badge badge-expired">ë§Œë£Œë¨</span>'
          : '<span class="admin-item-badge badge-active">í™œì„±</span>';

        return `
          <div class="admin-item ${r.expired ? 'expired' : ''}">
            <div>
              <div class="admin-item-name">${r.name}${badge}</div>
              <div class="admin-item-time">${new Date(r.time).toLocaleString("ko-KR")}</div>
              <div class="admin-item-type">${r.firstType} (${r.firstScore}ì )</div>
            </div>
            <button class="btn-view-result" onclick="viewAdminResult('${r.id}')">ê²°ê³¼ë³´ê¸°</button>
            <button class="btn-del" onclick="deleteAdminResult('${r.id}')">ì‚­ì œ</button>
          </div>
        `;
      }).join("");
    } catch (e) {
      console.error(e);
      alert("ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜");
    }
  }

  async function viewAdminResult(docId) {
    try {
      const res = await fetch(`${FN}/getResultById`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ docId })
      });
      const data = await res.json();
      closeAdmin();
      displayResult(data);
    } catch (e) {
      console.error(e);
      alert("ê²°ê³¼ ë¡œë“œ ì˜¤ë¥˜");
    }
  }

  async function deleteAdminResult(docId) {
    if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

    try {
      const res = await fetch(`${FN}/adminDeleteResult`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password: adminPassword, docId })
      });
      const data = await res.json();

      if (data.ok) {
        alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        loadAdminList();
      }
    } catch (e) {
      console.error(e);
      alert("ì‚­ì œ ì˜¤ë¥˜");
    }
  }
</script>

</body>
</html>
